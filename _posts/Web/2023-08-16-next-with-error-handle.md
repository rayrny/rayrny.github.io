---
layout: posts
title: "[Next.js] BFF ì„œë²„ ì¿ í‚¤ ìœ ì‹¤ ë¬¸ì œ ë° ì„œë²„ ì—ëŸ¬ ì „ì—­ í•¸ë“¤ë§ ì²˜ë¦¬í•˜ê¸°"
categories:
  - Next
last_modified_at: 2023-08-16
author_profile: true
tags:
  - next.js
  - BFF
  - ì—ëŸ¬ ì²˜ë¦¬
toc: true
toc_sticky: true
sidebar:
  title: Posts
  nav: "sidebar-contents"
---

ì´ ê¸€ì—ì„œëŠ” ì•„ë˜ ë‘ ê°€ì§€ ì£¼ì œì— ëŒ€í•´ ë‹¤ë£° ê²ƒì´ë‹¤.

1. BFF ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• ì„ í•  ë•Œ, ë¸Œë¼ìš°ì €ì™€ ë‹¬ë¦¬ í•„ìš”í•œ ì¿ í‚¤ê°€ ì—†ëŠ” ìƒíƒœì— ëŒ€í•œ í•´ê²° ë°©ì•ˆ
   1. ì„¤ëª…ì„ ë”í•˜ìë©´ BFFì—ì„œ API ìš”ì²­ì„ í†µí•´ ë‚´ë¶€ ìì›ì— ì ‘ê·¼í•˜ëŠ” ê²½ìš°, ì¦‰ `getServerSideProps`ë¥¼ í†µí•´ í˜ì´ì§€ë¥¼ êµ¬ì„±í•  ë•Œ í•„ìš”í•œ ë¸Œë¼ìš°ì € ì¿ í‚¤ ê°’ì„ ê°€ì§€ê³  ìˆì§€ ì•Šì€ ì±„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ëŠ” ê²½ìš°
   2. NextëŠ” ì´ê±¸ [ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ ëŠ˜ë¦¬ëŠ” ë°©í–¥](https://nextjs.org/docs/pages/building-your-application/data-fetching/get-server-side-props#getserversideprops-or-api-routes)ì´ë¼ê³  í–ˆìœ¼ë‚˜, ë¸Œë¼ìš°ì €ë“  ì„œë²„ë“  APIë¥¼ ì‚¬ìš©í•´ í†µì‹ í•˜ë¯€ë¡œ page routeì—ì„œ validate, ê¶Œí•œ ì²´í¬ ë“±ì„ í•œ ë²ˆì— ê´€ë¦¬í•˜ê¸° ìœ„í•´ í•´ë‹¹ ë°©ì‹ì„ ì„ íƒí–ˆë‹¤.
2. ì „ì—­ì ì¸ ì„œë²„ ì—ëŸ¬ ì²˜ë¦¬ - [í˜ì´ì§€ ê¶Œí•œ ì²˜ë¦¬, ErrorBoundary, ê° ì»´í¬ë„ŒíŠ¸ì—ì„œì˜ ì²˜ë¦¬]

## BFF ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• ì„ í•  ë•Œ, ë¸Œë¼ìš°ì €ì™€ ë‹¬ë¦¬ í•„ìš”í•œ ì¿ í‚¤ê°€ ì—†ëŠ” ìƒíƒœì— ëŒ€í•œ í•´ê²° ë°©ì•ˆ

---

### ğŸ«  ë¬¸ì œì 

ì²˜ìŒì—ëŠ” ë¬´ì—‡ì´ ë¬¸ì œì¸ì§€ ì´í•´í•˜ëŠ” ê²ƒ ì¡°ì°¨ ì–´ë ¤ì› ë‹¤. BFF ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• ê³¼ ì„œë²„ì˜ ì—­í• ì„ ë™ì‹œì— í•˜ê³  ìˆê¸°ì— ëˆˆì— ë³´ì´ì§€ ì•ŠëŠ” ë¶€ë¶„ì„ ì˜ë„ì ìœ¼ë¡œ ê·¸ë ¤ë‚´ì„œ ì´í•´í•´ì•¼ í–ˆê¸° ë•Œë¬¸ì´ë‹¤.

ë¡œê·¸ì¸ì„ ë§ˆì¹œ ìœ ì €ê°€ (ë¡œê·¸ì¸ì´ í•„ìš”í•œ) íŠ¹ì • í˜ì´ì§€ì— ì ‘ì†í•˜ë ¤ê³  í•˜ë©´,

ë¸Œë¼ìš°ì €ëŠ” ì„œë²„ì—ê²Œ í˜ì´ì§€ ìš”ì²­ì„ í•˜ê³ , ì´í›„ì— ì‹¤í–‰ë˜ëŠ” `getServerSideProps` ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ tanstack-queryë¥¼ í†µí•´ prefetch í•œë‹¤.

- ë”°ë¼ì„œ ì„œë²„(BFF)ì—ì„œ ë™ì‘í•˜ëŠ” ì½”ë“œì„ì—ë„ ë‹¤ì‹œ API ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ ë¸Œë¼ìš°ì €ê°€ ê°€ì§€ê³  ìˆëŠ” ì¿ í‚¤ë¥¼ í•¨ê»˜ ì „ì†¡í•˜ì§€ ì•Šê³  ìˆì–´ì„œ `UnauthorizedError` ë°œìƒ

ì„œë²„ì—ì„œ prefetch ê²°ê³¼ê°€ ì—ëŸ¬ì˜€ìœ¼ë¯€ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ ë‹¤ì‹œ ë°ì´í„° ìš”ì²­

- ì´ ë•ŒëŠ” ë¸Œë¼ìš°ì €ê°€ ìš”ì²­ì„ ë³´ë‚´ê¸° ë•Œë¬¸ì— ì¿ í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆìŒ

â†’ prefetchingì˜ ì˜ë¯¸ê°€ ì „í˜€ ì—†ëŠ” SSRì„ í•˜ê³  ìˆì—ˆë‹¤.

### ğŸ› ï¸Â í•´ê²° ë°©ì•ˆ

ê·¸ëŸ¬ë©´ ì„œë²„ì—ì„œ ë³´ë‚´ëŠ” ìš”ì²­ì¼ ê²½ìš°ì—ë„ ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ë¥¼ ì‹¤ì–´ì„œ ìš”ì²­ì„ ë³´ë‚´ì£¼ë©´ ë¬¸ì œê°€ í•´ê²°ë˜ê² êµ¬ë‚˜ ì‹¶ì—ˆë‹¤.

ë¨¼ì € ê¸°ì¡´ì˜ `getServerSideProps`ê°€ ì–´ë–»ê²Œ ì§œì—¬ìˆì—ˆëŠ”ì§€ ì‚´í´ë³´ë©´, `withSessionSsr`ì´ë¼ëŠ” HOFë¥¼ í†µí•´ reqì˜ ì¿ í‚¤ë¥¼ ì½ê³  ê²€ì¦í•œ ë’¤ì— ìœ íš¨í•œ ê²½ìš°ì— sessionì— ìœ ì € ì •ë³´ë¥¼ ë‹´ì•„ì„œ ë‚´ë ¤ì¤€ë‹¤.

```jsx
// page/.../index.jsx

export const getServerSideProps = withSessionSsr(async (context) => {
    const queryClient = new QueryClient();
    const session = context.req.session; // HOFì—ì„œ ë‹´ì•„ì¤€ ìœ ì € ì •ë³´ê°€ ìˆìŒ
    if (session) {
        /** session ì •ë³´ ì„¸íŒ… */
        await queryClient.prefetchQuery(...);
    }

		// í•„ìš”í•œ ë°ì´í„° prefetch -> ì´ ë•Œ ì¿ í‚¤ë¥¼ í•¨ê»˜ ë„˜ê²¨ì¤˜ì•¼ í•œë‹¤.
    await queryClient.prefetchQuery(...);

    return {
        props: {
            dehydratedState: dehydrate(queryClient),
        },
    };
});
```

**ë°©ì•ˆ 1 | ëª…ì‹œì ìœ¼ë¡œ í—¤ë”ì— ì¿ í‚¤ë¥¼ ë§¤ë²ˆ ë„£ì–´ì£¼ê¸°**

- prefetchingì‹œ ì¿ í‚¤ë¥¼ í•¨ê»˜ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬
- ë‚´ë¶€ì—ì„œëŠ” ì¸ìë¡œ ë°›ì€ ì¿ í‚¤ë¥¼ ì§ì ‘ í—¤ë”ì— ì„¤ì •í•˜ì—¬ axios ìš”ì²­ì„ ë³´ëƒ„

**ë°©ì•ˆ 2 | axiosInstance.interceptors ì‚¬ìš©í•˜ê¸°**

ë°©ì•ˆ 1ì€ ì—¬ëŸ¬ ê³³ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ë„˜ê²¨ì£¼ê³ , í—¤ë”ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì–´ì•¼ í•˜ëŠ”ë°, ë„ˆë¬´ ê·€ì°®ê³  ì¤‘ê°„ì— ë³€ì§ˆë  ê°€ëŠ¥ì„±ë„ í¬ë‹¤.

- ì¶”ê°€í•´ì£¼ì–´ì•¼ í•˜ëŠ” ì½”ë“œê°€ ë‘ ê³³ì¸ë° ì´ë¯¸ ë„ˆë¬´ ë³µì¡í•œ ë‹¨ê³„ë¥¼ ê±°ì³ ìš”ì²­ì´ ê°€ê³  ìˆëŠ” ìƒí™©ì— ì´ê²ƒê¹Œì§€ ì—¬ëŸ¬ ê³³ì—ì„œ ì‹ ê²½ì“°ê²Œ ë˜ë©´ DXê°€ ë„ˆë¬´ ë–¨ì–´ì§ˆ ê²ƒ ê°™ì•˜ë‹¤.

ë”°ë¼ì„œ `axiosInstance.interceptors`ë¥¼ ì‚¬ìš©í•˜ì—¬ 1ì°¨ì ìœ¼ë¡œ ë¦¬íŒ©í† ë§ í–ˆë‹¤.

- ë§¤ ìš”ì²­ ì‹œ í•´ë‹¹ ìš”ì²­ì„ ê°€ë¡œì±„ì„œ ì›í•˜ëŠ” ì¿ í‚¤ ê°’ì„ ë„£ì–´ì¤Œ (ê³µí†µ í—¤ë”ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê³  ê° ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ì´ë¯€ë¡œ ë™ì‹œì— ìš”ì²­ ë³´ëƒˆì„ ê²½ìš°ì—ë„ ì¿ í‚¤ê°€ ë®ì–´ì”Œì›Œì§€ì§€ ì•ŠìŒ)
- `getServerSideProps`ì—ì„œëŠ”Â prefetchingì‹œ ìš”ì²­ì„ ì¸í„°ì…‰íŠ¸í•  ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬ëœ axios ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ë‹¬

**ë°©ì•ˆ 3 | ì¿ í‚¤ê°€ ì„¤ì •ëœ axiosInstanceë¥¼ ì‚¬ìš©í•˜ê¸°**

ë‹¤ë§Œ ìœ„ ë°©ì•ˆ ì‚¬ìš© ì‹œ ê° ìš”ì²­ê°„ì˜ ì¶©ëŒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„ (ì—¬ëŸ¬ ìš”ì²­ì´ ë™ì‹œì— ë“¤ì–´ì™€ë„ ë…ë¦½ì ì¸ ê°ìì˜ ì¿ í‚¤ë¥¼ ê°€ì ¸ì•¼ í•¨) ë§¤ ë²ˆ ìƒˆë¡­ê²Œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ë³´ë‚´ì•¼ í–ˆê³ , ê·¸ë ‡ë‹¤ë©´ êµ³ì´ `interceptors`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë  ê²ƒ ê°™ë‹¤ëŠ” ì˜ê²¬ì´ ìˆì—ˆë‹¤.

**_thanks to._ @íšŒì‚¬\_ë™ë£Œ\_luke**ì˜ ìƒì‚°ì ì¸ ì½”ë“œë¦¬ë·°

> ì²˜ìŒì—ëŠ” interceptorsë¼ëŠ” ìƒˆë¡œìš´ ê²ƒì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì— ë“¤ë–´ì—ˆëŠ”ë° ë•ë¶„ì— ë‹¤ì‹œ ë…¼ë¦¬ì ìœ¼ë¡œ ìƒê°ì„ í•  ìˆ˜ ìˆì—ˆê³  ë¶ˆí•„ìš”í•˜ê²Œ ì¸í„°ì…‰í„°ë¥¼ ì¶”ê°€í–ˆë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤.

- ì„œë²„ì—ì„œ ë³´ë‚´ëŠ” ìš”ì²­ì€Â `getServerSideProps`Â ì—ì„œÂ `createServerAxios` (ì¿ í‚¤ê°€ ë‹´ê¸´ axios ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜)ë¥¼ í†µí•´ ìƒì„±

ì´ë ‡ê²Œ ì¤‘ê°„ì— ì¿ í‚¤ë¥¼ ë‹´ì•„ì„œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•¨ìœ¼ë¡œì¨ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆë‹¤.

### ğŸŒ¤ï¸Â ìì˜í•œ ì‹œí–‰ ì°©ì˜¤

`**queryClient.fetchQuery` ì™€ `queryClient.prefetchQuery`\*\*

- `prefetchQuery` ëŠ” ì‹¤íŒ¨ ì‹œì— ë³„ë„ë¡œ ì—ëŸ¬ë¥¼ ë˜ì§€ì§€ ì•Šê³  ê²°ê³¼ì— ì—ëŸ¬ë¥¼ ë‹´ì•„ì„œ ë³´ë‚´ì¤€ë‹¤.
  - `prefetch` ì˜ ëª©ì ì„ ìƒê°í•´ë³´ë©´ ì´í•´ê°€ ë˜ëŠ” ë™ì‘ì´ê¸´ í•˜ë‹¤. ì˜¤ë¥˜ ì—¬ë¶€ì™€ëŠ” ìƒê´€ì—†ì´ ë¯¸ë¦¬ ë°ì´í„°ë¥¼ ì°Œë¥´ëŠ” ê²ƒì¼ ë¿ì´ê³  ì´í›„ì— ëŒ€í•œ ê²°ê³¼ëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ ë‹¤ì‹œ ìš”ì²­ì„ ë³´ë‚¼ ì§€, ì—ëŸ¬ì— ëŒ€í•´ ì²˜ë¦¬í•  ì§€ ê²°ì •í•˜ëŠ”ê²Œ ë§ëŠ” ê²ƒ ê°™ë‹¤.
- ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ë¥¼ ë°”ë¡œ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´ `fetchQuery` ë¥¼ ì‚¬ìš©í•˜ì.

**`req.cookies` ì™€ `req.headers.cookie`**

- axiosì˜ req ì™€ next ì„œë²„ì˜ req í˜•ì‹ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— axios req.headers.cookieë¡œ ë‹´ì•„ì¤€ ê°’ì„ next ì„œë²„ìª½ ì½”ë“œì¸ checkAuthenticationì—ì„œ ì½ì§€ ëª»í•¨ (req.cookiesë¡œ ì ‘ê·¼)
- ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, api ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” `checkAuth() -> withSessionRoute` ì—ì„œ `req.headers.cookie`ë¥¼ `req.cookies`ì— ë„£ì–´ì¤Œ
  - ì‹¤ì œë¡œ `next-connext` ì—ì„œ í•˜ê³  ìˆëŠ” ì‘ì—… (ê·¼ë° ì™œ ì„œë²„ì—ì„œ ìš”ì²­ë³´ëƒˆì„ ë•ŒëŠ” ì € ì²˜ë¦¬ê°€ ì•ˆë˜ì–´ìˆëŠ” ê±´ì§€ ì •í™•í•˜ê²Œ ì´í•´ x, ë¸Œë¼ìš°ì €ê°€ ë³´ëƒˆê±°ë‚˜ bff ê°€ ë³´ëƒˆê±°ë‚˜ ì–´ì¨Œë“  ê°™ì€ axios ìš”ì²­ì´ ê·¸ëŒ€ë¡œ api ë¼ìš°íŠ¸ë¡œ ë„˜ì–´ê°€ëŠ”ê²Œ ì•„ë‹Œê°€?)
    ![https://github.com/goorm-dev/swcamp-site/assets/89910087/ed20efae-74ea-48d5-a8b0-53ed0a39d108](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e7883c67-430c-4cdb-a14e-8ba50f475c6c/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-27_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.04.44.png)
    https://github.com/goorm-dev/swcamp-site/assets/89910087/ed20efae-74ea-48d5-a8b0-53ed0a39d108

## ì „ì—­ì ì¸ ì„œë²„ ì—ëŸ¬ ì²˜ë¦¬

- [í˜ì´ì§€ ê¶Œí•œ ì²˜ë¦¬, ErrorBoundary, ê° ì»´í¬ë„ŒíŠ¸ì—ì„œì˜ ì²˜ë¦¬]

---

### ğŸ“Â ì „ì²´ì ì¸ ì»¨ì…‰

- ì„œë²„ **ì—ëŸ¬ í•¸ë“¤ë§ `_error.jsx`ì—ì„œ í•˜ê¸°**
  - ì—ëŸ¬ ë°œìƒ ì‹œ ë¬´ì¡°ê±´ ì—¬ê¸°ë¡œ ë–¨ì–´ì§
  - ë‹¤ë§Œ ì‹¤ì œ ì—ëŸ¬ í™”ë©´ì´ ë„ì›Œì§€ëŠ” ê²ƒì€ productionì¼ ë•Œë§Œì´ê³  devì—ì„œëŠ” ì—ëŸ¬ ë°œìƒ í™”ë©´ì´ ë³´ì—¬ì§ (for ë””ë²„ê¹…)
    > `pages/_error.js`Â is only used in production. In development youâ€™ll get an error with the call stack to know where the error originated from.
  - ê°œë°œ ë‚´ë‚´ ê¶Œí•œ ì²˜ë¦¬ê°€ ì˜ ë˜ëŠ”ì§€ í™•ì¸í•  ì¼ì€ ì—†ì„ê±°ë‹ˆê¹Œ í•„ìš”í•œ ê²½ìš°ì—ë§Œ production ë¹Œë“œí•´ì„œ í™•ì¸
- **ê¸°ì¡´ì— ì‚¬ìš©í•˜ê³  ìˆë˜ ì„¸ì…˜ ê´€ë ¨ HOFì—ì„œ í˜ì´ì§€ ê¶Œí•œ ì²˜ë¦¬ë„ í•¨ê»˜ í•  ìˆ˜ ìˆë„ë¡ í™•ì¥**
  - í˜ì´ì§€ì— ëŒ€í•œ ê¶Œí•œ ì²´í¬ë„ í•  ìˆ˜ ìˆë„ë¡
  - ì§€ê¸ˆì€ í˜ì´ì§€ì— ëŒ€í•œ ê¶Œí•œ ì²´í¬ëŠ” ì—†ê³  api ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²½ìš°ì— ê·¸ ìš”ì²­ì— ëŒ€í•œ ê¶Œí•œ í™•ì¸ + ì‘ë‹µìœ¼ë¡œ í™•ì¸ì´ ê°€ëŠ¥í•œë°, api ìš”ì²­ì„ ì²˜ìŒë¶€í„° ë³´ë‚´ì§€ ì•ŠëŠ” í˜ì´ì§€ì—ì„œ ì ‘ê·¼ì„ ë§‰ì•„ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆìŒ

### ğŸ«  ë¬¸ì œì 

NEXTë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìˆëŠ” ë‹¤ë¥¸ ë ˆí¬ì—ì„œëŠ” ì§ì ‘ ì„œë²„ë¥¼ êµ¬ì„±í•˜ë‹¤ ë³´ë‹ˆ, í˜ì´ì§€ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ ì²˜ë¦¬ë¥¼ routesë“¤ì´ ëª¨ì—¬ ìˆëŠ” í•œ ê³³ì—ì„œ í•  ìˆ˜ ìˆì—ˆë‹¤.

ê·¸ëŸ¬ë‚˜ NEXT ì‚¬ìš© ì‹œì—ëŠ” í”í•˜ê²Œ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´ì€ ì•„ë‹Œì§€ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì—ëŸ¬ í˜ì´ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²ƒì€ ì‰¬ì› ìœ¼ë‚˜, ìš°ë¦¬ê°€ êµ¬ë¶„í•´ë‘” ì—ëŸ¬ statusCodeì™€ëŠ” ë¬´ê´€í•˜ê²Œ ëª¨ë‘ 500.jsë¡œ ë–¨ì–´ì ¸ë²„ë ¸ë‹¤.

ì•„ë˜ì˜ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ” êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ë‚´ê¸° ìœ„í•´ ì—¬ëŸ¬ ì‹œë„ë¥¼ í•´ë³´ì•˜ë‹¤.

- ê° í˜ì´ì§€ì˜ `getServerSideProps` ë§ˆë‹¤ ì½”ë“œë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ì§€ ì•ŠìŒ
- API (axios) ì—ëŸ¬ì™€ ì¸ì¦ê³¼ ê´€ë ¨í•´ì„œ ê·¸ëƒ¥ throw í•˜ëŠ” ì—ëŸ¬ ëª¨ë‘ ë‹¤ë£° ìˆ˜ ìˆì–´ì•¼ í•¨

### ğŸ› ï¸Â í•´ê²° ë°©ì•ˆ

**ë°©ì•ˆ 1 | [getServerSidePropsë¥¼ tryâ€¦catch ë¡œ ê°ì‹¸ì£¼ëŠ” HOC](https://yceffort.kr/2021/10/api-error-handling-nextjs)** â†’ âŒ

- ë§ ê·¸ëŒ€ë¡œ `getServerSideProps`ë¥¼ try...catchë¡œ ê°ì‹¸ì„œ ë°œìƒí•œ ì—ëŸ¬ì— ëŒ€í•œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.
- ê° í˜ì´ì§€ë§ˆë‹¤ ì¶”ê°€ë¥¼ í•´ì¤˜ì•¼í•˜ë¯€ë¡œ ìš”êµ¬ì‚¬í•­ 1 ì„ ë§Œì¡±ì‹œí‚¤ì§€ ëª»í•´ì„œ íŒ¨ìŠ¤í–ˆë‹¤.

**ë°©ì•ˆ 2 | middleware.js** â†’ âŒ

- ë¯¸ë“¤ì›¨ì–´ë¥¼ íƒ€ëŠ” ì‹œì ì—ëŠ” ì•„ì§ í•´ë‹¹ í˜ì´ì§€ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì´ ì™„ë£Œë˜ì§€ ì•Šì•„ì„œ íŒë‹¨í•  ìˆ˜ê°€ ì—†ìœ¼ë¯€ë¡œ íŒ¨ìŠ¤..

**ë°©ì•ˆ 3 | ErrorBoundary ğŸ¤”**

- ì´ê±´ í˜ì´ì§€ ë‹¨ì—ì„œ ì§ì ‘ ì²˜ë¦¬í•˜ëŠ” ê²ƒê³¼ ë‹¤ë¦„ì´ ì—†ì–´ë³´ì¸ë‹¤.
- í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ ì²˜ë¦¬ì— ì í•©í•œ êµ¬ì¡°
- í˜ì´ì§€ ë‹¨ì—ì„œ ê¶Œí•œì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ê¸°ì—” ëª©ì ì— ë§ì§€ ì•Šì€ ê²ƒ ê°™ì•„ì„œ ë„˜ì–´ê°„ë‹¤.

**ë°©ì•ˆ 4 | [\_app.jsì˜ PageProps.error](https://suzie.world/posts/2021/error-handling-with-getserversideprops/)** â†’ âŒ

- `getInitialProps` ë¥¼ ì‚¬ìš©í•˜ëŠ” \_error.js í˜ì´ì§€ë¥¼ ì‚¬ìš©í•˜ê³  ë˜ì ¸ì§„ ì—ëŸ¬ë¥¼ \_app.jsì—ì„œ í•œ ë²ˆì— ì„¤ì •í•˜ëŠ” ë°©ë²•ì´ ìˆì–´ì„œ ì‚´í´ë³´ì•˜ë‹¤.
- server sideì—ì„œ ë°œìƒí•œ ì—ëŸ¬ëŠ” ì•ˆì¡í˜€ì„œ íŒ¨ìŠ¤..

**ë°©ì•ˆ 5 |** [\_error.js](https://nextjs.org/docs/pages/building-your-application/routing/custom-error#more-advanced-error-page-customizing) **âœ…**

- Nextì—ì„œ ì œì•ˆí•˜ëŠ” ì»¤ìŠ¤í…€ ì—ëŸ¬ í˜ì´ì§€ ê³ ë„í™” ë°©ë²•ì´ë‹¤. (ë°©ì•ˆ 4ì—ì„œë„ ì´ ì»¨ì…‰ì„ ì‚¬ìš©í•˜ì˜€ë‹¤.)
- ì—¬ê¸°ì„œ ë‚˜ëŠ” `res.writeHead` ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—ëŸ¬ì— ë”°ë¼ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘” ì—ëŸ¬ í˜ì´ì§€(/403, ...)ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚¤ëŠ” ë°©ë²•ì„ ì°¨ìš©í–ˆë‹¤.
  - ë¯¸ë¦¬ ì²˜ë¦¬í•˜ê³  ì‹¶ì€ ì—ëŸ¬ì— ëŒ€í•´ì„œëŠ” ê° í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚¤ê³ , ê²°ê³¼ì ìœ¼ë¡œ `_error.js`ì—ì„œëŠ” ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ë§Œ ë‹¤ë£° ìˆ˜ ìˆê²Œëœë‹¤.
- ê·¸ëŸ°ë°, ì„œë²„ ì—ëŸ¬ í•¸ë“¤ëŸ¬ê¹Œì§€ëŠ” 401, 403â€¦ ë¡œ ì˜ ì˜¤ëŠ”ë°, \_errorì—ì„œ ë°›ì€ê±´ `res.statusCode`ëŠ” ì¼ê´„ 500ì´ë‹¤. ğŸ˜­
  â†’ responseëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆìœ¼ë‹ˆê¹Œ 500ì¼ ìˆ˜ ë°–ì—..! ì—ëŸ¬ ê°ì²´ë¥¼ ë³´ë©´ ëœë‹¤.

```jsx
// page/_error.js
CustomErrorPage.getInitialProps = ({ res, err }) => {
  const errorName = err.name || err.response?.data.code;
  let statusCode = 500;
  switch (errorName) {
    case "UnauthorizedError":
      statusCode = 401;
      break;
    default:
      break;
  }

  if (statusCode !== 500) {
    res.writeHead(302, { Location: `/${statusCode}` });
    res.end();
  }

  return { statusCode, myError: statusCode };
};
```

ê´€ë ¨í•´ì„œ ì—¬ëŸ¬ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ì°¾ì•„ë³´ë‹¤ê°€ ë‚˜ì™€ ë™ì¼í•œ ìƒí™©ì— ì²˜í•œ ì‚¬ëŒì˜ ì´ìŠˆë¥¼ ë°œê²¬í–ˆê³ , ë¬´ë ¤ 1ë…„ ì „ ê¸€ì´ì§€ë§Œ ëˆ„êµ°ê°€ì—ê²Œë¼ë„ ë„ì›€ì´ ë˜ê¸¸ ë°”ë¼ë©° ëŒ“ê¸€ì„ ë‹¬ì•„ë‘ì—ˆë‹¤!

[How to handle unathorized errors thrown by the server Â· vercel/next.js Â· Discussion #39530](https://github.com/vercel/next.js/discussions/39530)

### ğŸŒ¤ï¸Â ìì˜í•œ ì‹œí–‰ ì°©ì˜¤

- `_error.jsx`ëŠ” ì—†ë‹¤
  - Nextì—ì„œ ì œê³µí•˜ëŠ” ì˜ˆì•½ì–´ í˜ì´ì§€ ì…‹ì´ë¯€ë¡œ ì´ë¦„ì„ ì •í™•í•˜ê²Œ `_error.js`ë¡œ í•´ì•¼í•œë‹¤.
